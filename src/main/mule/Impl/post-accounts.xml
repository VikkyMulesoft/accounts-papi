<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	

	<sub-flow name="post-accountsSub_Flow" doc:id="88e47bde-aa87-46f7-8fb1-8ee3175be764" >
		<logger level="INFO" doc:name="Log-before-request" doc:id="b640180c-82e3-415d-83f8-5326119e19d8" message='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;	"log-trace" : "beforeRequest_post-accounts-Impl",&#10;	"correlationId": vars.correlationId,&#10;	"payload": payload default""&#10;}]'/>
		<ee:cache doc:name="Cache" doc:id="50321d01-3599-43e5-bbc3-7845dfc6ced8" >
			<http:request method="GET" doc:name="get-countries-sapi" doc:id="889a7253-2151-4985-bca1-a0cbe7d60409" config-ref="HTTP_Req_first-country-lookup-sapi" sendCorrelationId="ALWAYS" correlationId="#[vars.correlationId]" path="${countries_lookup_sapi.path}" responseTimeout="${countries_lookup_sapi.responsetimeout}" >
				<http:headers ><![CDATA[#[%dw 2.0
output application/json
---
{
   "client_id": p('secure::countries_lookup_sapi.client_id'),
   "client_secret": p('secure::countries_lookup_sapi.client_secret'),   
   "x-correlation-Id": vars.correlationId
}]]]></http:headers>
			</http:request>
		</ee:cache>
		<logger level="INFO" doc:name="Log-after-request" doc:id="5ff2818f-336d-462e-ae46-7350f7b8a0cc" message='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;	"log-trace" : "afterRequest_post-accounts_getcountries-Impl",&#10;	"correlationId": vars.correlationId,&#10;	"payload": payload default""&#10;}]'/>
		<logger level="INFO" doc:name="beforeRequest" doc:id="975560bb-4b48-4603-a6f3-8b1a60cd9421" message='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;	"log-trace" : "beforeRequest_post-accounts-sapi",&#10;	"correlationId": vars.correlationId,&#10;	"payload": payload default""&#10;}]'/>
		<ee:transform doc:name="request" doc:id="5ca55681-245c-4918-a90d-ead507b8653f" >
			<ee:message >
				<ee:set-payload resource="dwl/post-account-request.dwl" />
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="create-account-sapi" doc:id="0761f144-8edd-4560-8179-2ba09be73535" config-ref="HTTP_Req-accounts-sfdc-sapi" path="${accounts_sfdc_sys_api.path}" responseTimeout="${accounts_sfdc_sys_api.responsetimeout}" sendCorrelationId="ALWAYS" correlationId="#[correlationId]">
		
			<http:headers ><![CDATA[#[%dw 2.0
output application/json
---
{
   "client_id": p('secure::accounts-sfdc-sys-api.client_id'),
   "client_secret": p('secure::accounts-sfdc-sys-api.client_secret'),   
   "x-correlation-Id": vars.correlationId
}]]]></http:headers>
		</http:request>
		<logger level="INFO" doc:name="log-after-request" doc:id="c0fe245d-04d6-473a-8402-cc925c19990a" message='#[%dw 2.0&#10;---&#10;{&#10;	"log-trace" : "afterRequest_post-accounts-sapi",&#10;	"correlationId": vars.correlationId,&#10;	"payload": payload default""&#10;}]' />
	</sub-flow>
</mule>
